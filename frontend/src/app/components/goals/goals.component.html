<div class="goals-container">
  <div class="goals-header">
    <h1>My Goals</h1>
    <div class="header-actions">
      <button class="btn-secondary" (click)="openTemplatesModal()">ğŸ“‹ Templates</button>
      <button class="btn-primary" (click)="openCreateForm()">+ New Goal</button>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <select [(ngModel)]="filterStatus" (change)="applyFilters()">
      <option value="">All Statuses</option>
      <option value="active">Active</option>
      <option value="completed">Completed</option>
      <option value="abandoned">Abandoned</option>
    </select>
    <select [(ngModel)]="filterPriority" (change)="applyFilters()">
      <option value="">All Priorities</option>
      <option value="low">Low</option>
      <option value="medium">Medium</option>
      <option value="high">High</option>
    </select>
    <button class="btn-secondary" (click)="clearFilters()">Clear Filters</button>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="loading">
    <p>Loading goals...</p>
  </div>

  <!-- Error -->
  <div *ngIf="error" class="error">
    <p>{{ error }}</p>
    <button (click)="loadGoals()">Retry</button>
  </div>

  <!-- Goals List -->
  <div *ngIf="!loading && !error" class="goals-list">
    <div *ngIf="goals.length === 0" class="empty-state">
      <p>No goals found. Create your first goal to get started!</p>
    </div>

    <div *ngFor="let goal of goals" class="goal-card" [class.completed]="goal.status === 'completed'">
      <div class="goal-header">
        <div>
          <h3>{{ goal.title }}</h3>
          <span class="badge" [class]="'badge-' + goal.priority">{{ goal.priority }}</span>
          <span class="badge" [class]="'badge-' + goal.status">{{ goal.status }}</span>
        </div>
        <div class="goal-actions">
          <button class="btn-icon" (click)="duplicateGoal(goal)" title="Duplicate goal">ğŸ“‹</button>
          <button class="btn-icon" (click)="openEditForm(goal)" title="Edit goal">âœï¸</button>
          <button class="btn-icon" (click)="deleteGoal(goal)" title="Delete goal">ğŸ—‘ï¸</button>
        </div>
      </div>

      <p *ngIf="goal.description" class="goal-description">{{ goal.description }}</p>

      <div class="goal-dates">
        <span>Start: {{ goal.startDate | date:'shortDate' }}</span>
        <span>Due: {{ goal.dueDate | date:'shortDate' }}</span>
      </div>

      <div *ngIf="goal.category" class="goal-category">{{ goal.category }}</div>
    </div>
  </div>

  <!-- Goal Form Modal -->
  <div *ngIf="showForm" class="modal-overlay" (click)="closeForm()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <app-goal-form
        [goal]="editingGoal"
        (saved)="onGoalSaved()"
        (cancelled)="closeForm()">
      </app-goal-form>
    </div>
  </div>

  <!-- Templates Modal -->
  <div *ngIf="showTemplates" class="modal-overlay" (click)="closeTemplatesModal()">
    <div class="modal-content templates-modal" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h2>Goal Templates</h2>
        <button class="btn-icon" (click)="closeTemplatesModal()">âœ•</button>
      </div>
      
      <div *ngIf="loadingTemplates" class="loading">
        <p>Loading templates...</p>
      </div>

      <div *ngIf="!loadingTemplates" class="templates-list">
        <div *ngIf="templates.length === 0" class="empty-state">
          <p>No templates available.</p>
        </div>

        <div *ngFor="let template of templates" class="template-card">
          <div class="template-header">
            <h3>{{ template.name }}</h3>
            <span *ngIf="template.isSystem" class="badge badge-system">System</span>
            <span *ngIf="template.category" class="badge" [class]="'badge-' + template.priority">{{ template.category }}</span>
          </div>
          
          <p *ngIf="template.description" class="template-description">{{ template.description }}</p>
          
          <div class="template-info">
            <span class="info-item">ğŸ“… {{ template.estimatedDuration }} days</span>
            <span class="info-item">ğŸ“ {{ template.steps?.length || 0 }} steps</span>
          </div>

          <div *ngIf="template.steps && template.steps.length > 0" class="template-steps-preview">
            <strong>Steps:</strong>
            <ul>
              <li *ngFor="let step of template.steps.slice(0, 3)">{{ step.title }}</li>
              <li *ngIf="template.steps.length > 3" class="more-steps">+ {{ template.steps.length - 3 }} more</li>
            </ul>
          </div>

          <button class="btn-primary" (click)="createGoalFromTemplate(template)">
            Use Template
          </button>
        </div>
      </div>
    </div>
  </div>
</div>
